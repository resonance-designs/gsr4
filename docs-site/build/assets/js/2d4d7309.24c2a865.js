"use strict";(self.webpackChunktlbx_docs=self.webpackChunktlbx_docs||[]).push([[598],{4773(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"developer/state-management","title":"State & Synchronization","description":"Managing state between a high-priority audio thread and a low-priority UI thread is one of the most critical aspects of GrainRust.","source":"@site/docs/developer/state-management.md","sourceDirName":"developer","slug":"/developer/state-management","permalink":"/docs/developer/state-management","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"State & Synchronization","sidebar_position":5},"sidebar":"devSidebar","previous":{"title":"UI System","permalink":"/docs/developer/ui-system"}}');var r=n(4848),s=n(8453);const i={title:"State & Synchronization",sidebar_position:5},o="State & Synchronization",l={},c=[{value:"Parameter Management",id:"parameter-management",level:2},{value:"The <code>Params</code> Struct",id:"the-params-struct",level:3},{value:"Thread Synchronization",id:"thread-synchronization",level:2},{value:"Atomic Float Pattern",id:"atomic-float-pattern",level:3},{value:"ParamSetter",id:"paramsetter",level:3},{value:"Project Persistence (.tlbx)",id:"project-persistence-tlbx",level:2},{value:"Global Clock Synchronization",id:"global-clock-synchronization",level:2}];function d(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"state--synchronization",children:"State & Synchronization"})}),"\n",(0,r.jsx)(t.p,{children:"Managing state between a high-priority audio thread and a low-priority UI thread is one of the most critical aspects of GrainRust."}),"\n",(0,r.jsx)(t.h2,{id:"parameter-management",children:"Parameter Management"}),"\n",(0,r.jsxs)(t.p,{children:["GrainRust uses the ",(0,r.jsx)(t.code,{children:"nih-plug"})," parameter system to manage all automatable values."]}),"\n",(0,r.jsxs)(t.h3,{id:"the-params-struct",children:["The ",(0,r.jsx)(t.code,{children:"Params"})," Struct"]}),"\n",(0,r.jsxs)(t.p,{children:["Defined in ",(0,r.jsx)(t.code,{children:"src/lib.rs"}),", the ",(0,r.jsx)(t.code,{children:"Params"})," struct contains every control available to the user. Each parameter is wrapped in a type like ",(0,r.jsx)(t.code,{children:"FloatParam"}),", ",(0,r.jsx)(t.code,{children:"IntParam"}),", or ",(0,r.jsx)(t.code,{children:"BoolParam"}),"."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Normalization"}),": ",(0,r.jsx)(t.code,{children:"nih-plug"}),' handles the conversion between "real-world" values (like Decibels or Hertz) and a normalized ',(0,r.jsx)(t.code,{children:"0.0"})," to ",(0,r.jsx)(t.code,{children:"1.0"})," range."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Automation"}),": By using this system, all GrainRust controls automatically support DAW automation and MIDI mapping."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"thread-synchronization",children:"Thread Synchronization"}),"\n",(0,r.jsxs)(t.p,{children:["To avoid data races and audio glitches, GrainRust uses ",(0,r.jsx)(t.strong,{children:"Atomics"})," for all real-time communication."]}),"\n",(0,r.jsx)(t.h3,{id:"atomic-float-pattern",children:"Atomic Float Pattern"}),"\n",(0,r.jsxs)(t.p,{children:["Since Rust does not have a native ",(0,r.jsx)(t.code,{children:"AtomicF32"})," on all platforms, GrainRust uses the ",(0,r.jsx)(t.strong,{children:"bit-casting pattern"}),":"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-rust",children:"// Writing a value (UI Thread)\natomic_u32.store(value.to_bits(), Ordering::Relaxed);\n\n// Reading a value (Audio Thread)\nlet value = f32::from_bits(atomic_u32.load(Ordering::Relaxed));\n"})}),"\n",(0,r.jsx)(t.h3,{id:"paramsetter",children:"ParamSetter"}),"\n",(0,r.jsxs)(t.p,{children:["When the UI needs to update a parameter, it must use the ",(0,r.jsx)(t.code,{children:"ParamSetter"}),". This ensures that the update is:"]}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Thread-safe."}),"\n",(0,r.jsx)(t.li,{children:"Reported to the host DAW for automation recording."}),"\n",(0,r.jsx)(t.li,{children:"Propagated to the audio thread correctly."}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"project-persistence-tlbx",children:"Project Persistence (.tlbx)"}),"\n",(0,r.jsxs)(t.p,{children:["GrainRust uses a custom project format with the ",(0,r.jsx)(t.code,{children:".tlbx"})," extension."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Format"}),": JSON-based serialization."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Contents"}),": Stores all parameter states, track configurations, and references to loaded samples."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Exporting"}),': The "Export" feature bundles the ',(0,r.jsx)(t.code,{children:".tlbx"})," file and all associated audio samples into a single ",(0,r.jsx)(t.code,{children:".zip"})," archive for easy sharing between systems."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"global-clock-synchronization",children:"Global Clock Synchronization"}),"\n",(0,r.jsx)(t.p,{children:"The audio engine maintains a master clock that is synchronized to the host transport."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"BPM/Tempo"}),": Read from the host via ",(0,r.jsx)(t.code,{children:"nih-plug"}),"'s ",(0,r.jsx)(t.code,{children:"ProcessContext"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Phase Locking"}),": If the host is playing, GrainRust aligns its internal step sequencers and LFOs to the host's beat position."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Standalone Mode"}),": In standalone mode, GrainRust uses an internal high-precision timer to drive the clock."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453(e,t,n){n.d(t,{R:()=>i,x:()=>o});var a=n(6540);const r={},s=a.createContext(r);function i(e){const t=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);