"use strict";(self.webpackChunktlbx_docs=self.webpackChunktlbx_docs||[]).push([[892],{6888(e,n,i){i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>a,frontMatter:()=>l,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"developer/architecture","title":"Architecture Overview","description":"GrainRust is a high-performance, 4-track granular sampler and synthesizer built with Rust, nih-plug, and Slint. It is designed to function as both a standalone application and a professional audio plugin (VST3/CLAP).","source":"@site/docs/developer/architecture.md","sourceDirName":"developer","slug":"/developer/architecture","permalink":"/docs/developer/architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Architecture Overview","sidebar_position":2},"sidebar":"devSidebar","previous":{"title":"Developer Onboarding","permalink":"/docs/developer/onboarding"},"next":{"title":"Audio Engine","permalink":"/docs/developer/audio-engine"}}');var r=i(4848),s=i(8453);const l={title:"Architecture Overview",sidebar_position:2},d="Architecture Overview",o={},c=[{value:"Core Philosophy",id:"core-philosophy",level:2},{value:"System Architecture",id:"system-architecture",level:2},{value:"1. The Host Wrapper (<code>nih-plug</code>)",id:"1-the-host-wrapper-nih-plug",level:3},{value:"2. The Monolithic Engine (<code>src/lib.rs</code>)",id:"2-the-monolithic-engine-srclibrs",level:3},{value:"3. DSP Engine (<code>fundsp</code>)",id:"3-dsp-engine-fundsp",level:3},{value:"4. UI Layer (<code>Slint</code>)",id:"4-ui-layer-slint",level:3},{value:"Threading Model",id:"threading-model",level:2},{value:"Data Flow",id:"data-flow",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"architecture-overview",children:"Architecture Overview"})}),"\n",(0,r.jsxs)(n.p,{children:["GrainRust is a high-performance, 4-track granular sampler and synthesizer built with ",(0,r.jsx)(n.strong,{children:"Rust"}),", ",(0,r.jsx)(n.strong,{children:"nih-plug"}),", and ",(0,r.jsx)(n.strong,{children:"Slint"}),". It is designed to function as both a standalone application and a professional audio plugin (VST3/CLAP)."]}),"\n",(0,r.jsx)(n.h2,{id:"core-philosophy",children:"Core Philosophy"}),"\n",(0,r.jsxs)(n.p,{children:["The project follows a ",(0,r.jsx)(n.strong,{children:"data-oriented design"})," with a strict separation between the high-priority audio processing thread and the lower-priority UI/Event thread. All communication between these threads is ",(0,r.jsx)(n.strong,{children:"lock-free"})," to ensure glitch-free audio performance."]}),"\n",(0,r.jsx)(n.h2,{id:"system-architecture",children:"System Architecture"}),"\n",(0,r.jsxs)(n.h3,{id:"1-the-host-wrapper-nih-plug",children:["1. The Host Wrapper (",(0,r.jsx)(n.code,{children:"nih-plug"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["The entry point for the plugin is ",(0,r.jsx)(n.code,{children:"lib.rs"}),", which implements the ",(0,r.jsx)(n.code,{children:"Plugin"})," trait from the ",(0,r.jsx)(n.code,{children:"nih-plug"})," crate. This handles:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Audio buffer management."}),"\n",(0,r.jsx)(n.li,{children:"Parameter registration and automation."}),"\n",(0,r.jsx)(n.li,{children:"MIDI event processing."}),"\n",(0,r.jsx)(n.li,{children:"GUI lifecycle management."}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"2-the-monolithic-engine-srclibrs",children:["2. The Monolithic Engine (",(0,r.jsx)(n.code,{children:"src/lib.rs"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Due to the complexity of the 4-track routing and shared DSP resources, the core logic is currently centralized in ",(0,r.jsx)(n.code,{children:"src/lib.rs"}),". This monolith manages:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Transport & Synchronization"}),": A global clock that stays in sync with the host DAW."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Track Management"}),': Four independent tracks, each capable of running different "engines" (Tape-Deck, Granulator, etc.).']}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Master Effects"}),": Global compression and filtering applied at the end of the signal chain."]}),"\n"]}),"\n",(0,r.jsxs)(n.h3,{id:"3-dsp-engine-fundsp",children:["3. DSP Engine (",(0,r.jsx)(n.code,{children:"fundsp"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["Audio processing is powered by ",(0,r.jsx)(n.code,{children:"fundsp"}),". While some logic is imperative (the process loop), complex signal chains for specific engines (like the Silk or Texture devices) are built using ",(0,r.jsx)(n.code,{children:"fundsp"}),"'s functional composition."]}),"\n",(0,r.jsxs)(n.h3,{id:"4-ui-layer-slint",children:["4. UI Layer (",(0,r.jsx)(n.code,{children:"Slint"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:["The user interface is defined in ",(0,r.jsx)(n.code,{children:".slint"})," files and compiled into highly efficient C++ or Rust code."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Windowing"}),": Bridges ",(0,r.jsx)(n.code,{children:"Slint"}),", ",(0,r.jsx)(n.code,{children:"baseview"}),", and ",(0,r.jsx)(n.code,{children:"softbuffer"})," for cross-platform rendering."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Component Kit"}),": Uses the ",(0,r.jsx)(n.strong,{children:"Resonance Designs Slint UI Component Kit"})," for standardized knobs, sliders, and visualizers."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"threading-model",children:"Threading Model"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Thread"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Responsibility"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Priority"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Synchronization"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"Audio Thread"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"DSP Processing, Recording, Metering"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Real-time"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Atomic Reads/Writes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"UI Thread"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Rendering, Input Handling, Animation"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Normal"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Atomic Writes, Message Passing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"Background Thread"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"File I/O, Project Loading/Saving"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Low"}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"Mutex/Channels"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"data-flow",children:"Data Flow"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Host"})," provides an audio buffer to the ",(0,r.jsx)(n.strong,{children:"Audio Thread"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Audio Thread"})," reads parameters (Atomic ",(0,r.jsx)(n.code,{children:"f32"})," bits) and processes 4 tracks into a master buffer."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Audio Thread"})," updates RMS/Peak meters (Atomic ",(0,r.jsx)(n.code,{children:"f32"})," bits)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"UI Thread"})," polls meters and updates the Slint state."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User Interaction"})," on the UI triggers callbacks that update parameters via ",(0,r.jsx)(n.code,{children:"ParamSetter"}),"."]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453(e,n,i){i.d(n,{R:()=>l,x:()=>d});var t=i(6540);const r={},s=t.createContext(r);function l(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);